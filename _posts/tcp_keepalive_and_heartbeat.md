---
title: TCP-Keeplive与应用层心跳包
toc: true
comments: true
date: 2017-08-20 21:57:43
tags: Linux
categories: keeplive
---

```c
setsockopt(sockfd, SOL_SOCKET, SO_KEEPLIVE, &on, sizeof(on));
```

<!--more-->

1. `SO_KEEPLIVE`实现在服务器侧，由服务器来进行侦测，客户端被动响应，默认时间120s。应用层心跳则是客户端主动上报，服务端收集心跳信息，时间自定义。
2. `SO_KEEPLIVE`的实现在TCP协议栈(第四层)，应用层心跳实现在第七层。`SO_KEEPLIVE`由TCP协议规定，应用层的心跳则是由自己来定义协议。
3. `SO_KEEPLIVE`是TCP协议自带的保活功能, 使用起来简单, 减少了应用层代码的复杂度. 也会更节省流量。
4. 应用层心跳比较**灵活**, 因为协议层的心跳只能提供最纯粹的检活功能, 但是应用层自己可以随意控制, 包括协议可能提供的是秒级的。同时，应用层心跳比较**通用**, 应用层的心跳不依赖协议. 如果有一天不用TCP要改为UDP了, 协议层不提供心跳机制了, 但是你应用层的心跳依旧是通用的, 可能只需要做少许改动就可以继续使用。应用层心跳的不好的地方也很显而易见, 增加开发工作量, 由于应用特定的网络框架, 还可能很增加代码结构的复杂度，同时，应用层心跳的流量消耗更大。